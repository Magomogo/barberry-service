<html>
<head>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <style>
        .dl-horizontal dt {width:300px; padding: 0 10px}
        .dl-horizontal img {margin: 10px}
    </style>
</head>
<body>
<a href="https://github.com/Magomogo/barberry-service">
    <img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png" alt="Fork me on GitHub">
</a>
<div class="container">

    <div class="hero-unit">
        <h1>Image hosting with Barberry</h1>

        <p>
            This is a demo deployment of Barberry service. Source code can be found
            <a href = "https://github.com/Magomogo/barberry-service">at GitHub</a>
        </p>
    </div>

    <form name="uploadForm" method="post" enctype="multipart/form-data" class="form-inline">
        <fieldset>
            <legend>Select an image and hit 'Upload!' button</legend>
            <input type="file" name="file" id="file" required/>
            <a class="btn" href="javascript:barberryDemo.upload()">Upload!</a>
        </fieldset>
    </form>

    <h3>POST response:</h3>
    <pre id="log">empty</pre>
    <h3>GET responses:</h3>
    <dl id="images">
        <dd>empty</dd>
    </dl>
</div>

<script>
    var barberryDemo = (function () {

        function log(text) {
            var textNode = document.getElementById('log').childNodes[0];
            textNode.parentNode.replaceChild(document.createTextNode(text), textNode);
        }

        function prepareImageContainer() {
            var dl = document.createElement('dl');
            dl.setAttribute('id', 'images');
            dl.setAttribute('class', 'dl-horizontal');
            document.getElementById('images').parentNode.replaceChild(dl, document.getElementById('images'));
        }

        function appendImage(src, description) {
            var image = document.createElement('img'),
                dd = document.createElement('dd'),
                dt = document.createElement('dt');
            image.src = src;
            image.className = 'img-polaroid';

            document.getElementById('images').appendChild(dt);
            document.getElementById('images').appendChild(dd);
            dt.appendChild(document.createTextNode(description));
            dd.appendChild(image);
        }

        function onload(event) {
            prepareImageContainer();
            if (event.target.status == 201) {
                var doc = eval('(' + event.target.responseText + ')');
                log(JSON.stringify(doc, null, '\t'));

                for (var w = 100; w <= 300; w = w + 100) {
                    var src = doc.id + '_' + w + 'x.' + doc.ext;
                    appendImage(src, 'GET /' + src);
                }
            } else {
                log("Error " + event.target.status + " occurred uploading your file.");
            }
        }

        return {
            upload: function () {
                var oReq = new XMLHttpRequest();
                oReq.open("POST", "/", true);
                oReq.onload = onload;
                oReq.send(new FormData(document.forms.namedItem("uploadForm")));
            }
        }
    }());
</script>

</body>
</html>
